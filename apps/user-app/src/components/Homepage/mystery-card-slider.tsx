"use client";
import React, { useEffect, useState } from "react";
import { Swiper, SwiperSlide } from "swiper/react";
import { FreeMode, Pagination } from "swiper/modules";
import "swiper/css";
import "swiper/css/free-mode";
import { useAudioPlayerStore } from "@/store/audioplayer.store";
import { useMiniPlayerStore } from "@/store/miniplayer.store";
import { useMediaQuery } from "react-responsive";

const MysteryCardSlider: React.FC = () => {
  const {
    albumSongs,
    currentSongIndex,
    playSong,
    setCurrentSongIndex,
    setDiscovered,
    setShowStreamingLinks,
  } = useAudioPlayerStore();

  const { showMiniPlayer } = useMiniPlayerStore();

  const items = Array.from({ length: 20 }, (_, i) => i + 1);

  const isMobile = useMediaQuery({ maxWidth: 767 });
  const isTablet = useMediaQuery({ minWidth: 768, maxWidth: 1024 });

  const [loading, setLoading] = useState(true);
  const slidesPerView = 6;

  useEffect(() => {
    const timer = setTimeout(() => setLoading(false), 200);
    return () => clearTimeout(timer);
  }, []);

  const playRandomSong = () => {
    if (!albumSongs.length) return;

    let randomIndex = Math.floor(Math.random() * albumSongs.length);
    while (albumSongs.length > 1 && randomIndex === currentSongIndex) {
      randomIndex = Math.floor(Math.random() * albumSongs.length);
    }

    const randomSong = albumSongs[randomIndex];
    if (!randomSong?.id) {
      console.warn("Song object or song ID is missing.");
      return;
    }

    setDiscovered(false);
    setShowStreamingLinks(false);

    setCurrentSongIndex(randomIndex);
    playSong(randomSong.id);

    showMiniPlayer();
  };

  const getSlideStyles = () => {
    if (isMobile) {
      return {
        
        width: "175px",
        height: "240.6px",
      };
    }
    if (isTablet) {
      return {
        width: "180px",
        height: "237px",
      };
    }
    return {
      width: "230px",
      height: "320px",
    };
  };


  if (loading) {
    return (
      <div className="flex h-[500px] w-full justify-between gap-5">
        {Array.from({ length: isMobile ? slidesPerView : 3 }).map((_, index) => (
          <div
            key={index}
            className=" flex md:h-[400px] md:w-[300px] w-[250px] h-[300px]  flex-col gap-4 rounded-[8px] p-4 transition-opacity ease-in-out"
            style={{ opacity: 0.5 }}
          />
        ))}
      </div>
    );
  }

  return (
    <div className="relative mx-auto h-full w-full">
    
        
      <Swiper
        spaceBetween={8}
        slidesPerView={6.8}
        freeMode={true}
        modules={[FreeMode, Pagination]}
        breakpoints={{
          // Mobile devices
          0: {
            slidesPerView: 2.2,
          },
          // Tablets
          640: {
            slidesPerView: 3,
          },
          // Desktops
          1024: {
            slidesPerView: 6.8,
          },
        }}
      className="h-full w-full cursor-grab "
      >
       
        {items.map((item) => (
          <SwiperSlide
            key={item}
            style={{
              ...getSlideStyles(),
              gap: "40px",
              borderRadius: "8px",
            }}
            onClick={playRandomSong}
          >
            <div className="h-full w-full">

           
            <div className="w-full h-full flex flex-col items-center px-[12px] pt-[12px] pb-[93.838px] gap-[40px] bg-[#121310] rounded-[8px] ml-6">
            <div className="flex  w-full  items-start justify-between ">
              <div>
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  width="20"
                  height="20"
                  viewBox="0 0 20 20"
                  fill="none"
                >
                  <path
                    d="M8.40908 9.96908L16.1363 7.19239V11.8089C15.6772 11.5448 15.1312 11.3917 14.5454 11.3917C12.9137 11.3917 11.5909 12.58 11.5909 14.0458C11.5909 15.5117 12.9137 16.7 14.5454 16.7C16.1772 16.7 17.5 15.5117 17.5 14.0458V6.24363C17.5 5.31031 17.5 4.52758 17.4269 3.90393C17.4166 3.81579 17.4043 3.72816 17.3908 3.64641C17.3204 3.22034 17.196 2.82287 16.9558 2.49097C16.8357 2.32501 16.6867 2.17546 16.501 2.0469C16.4662 2.0228 16.43 1.99943 16.3926 1.97683L16.3851 1.97232C15.7422 1.58794 15.0194 1.61543 14.2748 1.78587C13.5548 1.95071 12.662 2.2864 11.5673 2.69802L9.66358 3.4138C9.1505 3.60671 8.71575 3.77016 8.3745 3.93945C8.01147 4.11956 7.69874 4.332 7.46423 4.64856C7.2297 4.96514 7.1323 5.3063 7.08751 5.67669C7.04542 6.02481 7.04543 6.44816 7.04546 6.94785V13.4422C6.58622 13.1782 6.04029 13.025 5.45454 13.025C3.82279 13.025 2.5 14.2133 2.5 15.6792C2.5 17.145 3.82279 18.3333 5.45454 18.3333C7.08629 18.3333 8.40908 17.145 8.40908 15.6792V9.96908Z"
                    fill="#C1FF70"
                  />
                </svg>
              </div>
              <div className="inline-flex items-center gap-1 rounded-full bg-[#1b1f15] px-[10px] py-[6px]">
                <div>
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    width="13"
                    height="14"
                    viewBox="0 0 13 14"
                    fill="none"
                  >
                    <g clipPath="url(#clip0_3319_1051)">
                      <path
                        d="M9.86422 6.52774C10.0897 6.34188 11.3917 5.53649 12.1047 4.85805C12.6613 4.32789 12.8766 2.9436 12.0204 2.27024C10.9073 1.39578 9.83883 2.31391 9.83883 2.31391C9.83883 2.31391 9.74539 1.79492 9.09539 1.49024C8.2768 1.10633 7.23985 0.963126 6.28617 0.975314C5.36196 0.986485 4.51086 1.0982 3.75524 1.46891C3.07883 1.80102 3.03821 2.2743 3.03821 2.2743C3.03821 2.2743 2.15055 1.42625 1.06282 2.11484C-0.0239031 2.80445 0.287894 4.1857 0.810941 4.76563C1.49242 5.52125 2.31102 5.90617 2.68274 6.18445C3.05344 6.46274 3.40891 6.72781 3.40891 6.96649C3.40891 7.20516 3.30328 7.25797 3.26266 7.24477C3.22305 7.23156 3.15297 6.99899 2.97117 7.09852C2.72336 7.23563 2.79852 7.78813 3.31547 7.84094C3.81617 7.89274 3.91164 7.3636 3.91164 7.3636L3.99086 6.84664L4.8125 7.41641L5.71336 8.15883L5.68696 8.79461C5.68696 8.79461 5.64735 9.28516 5.40868 9.70969C5.17 10.1342 4.7861 10.5577 4.7861 10.5577L4.77391 10.9416L8.1143 10.8624L8.00867 10.4917C8.00867 10.4917 7.57805 10.0184 7.31907 9.51063C7.13422 9.14703 7.10477 8.78039 7.10477 8.78039L7.09664 7.86836L8.83032 6.80602C8.83032 6.80602 9.01618 6.95227 8.98977 7.00508C8.96336 7.05789 8.95727 7.59922 9.37368 7.80031C9.785 7.99938 10.1161 7.7475 10.0765 7.40219C10.0369 7.05789 9.82461 7.17672 9.7586 7.22953C9.69258 7.28235 9.54633 7.29555 9.50672 7.09649C9.4661 6.89945 9.63875 6.71359 9.86422 6.52774ZM1.32992 4.65289L0.932816 3.4443L1.41321 2.81563L1.95149 2.6582C1.95149 2.6582 2.63907 3.17109 2.66344 3.21274C2.68782 3.25438 3.10219 4.10649 3.10219 4.10649L3.6486 6.08492L1.32992 4.65289ZM9.13602 6.24235C9.14414 6.2007 9.64891 4.12274 9.64891 4.12274C9.64891 4.09836 10.0044 3.93281 10.0044 3.8993C10.0044 3.86578 10.6503 2.81461 10.6503 2.81461L11.7269 2.85625L11.9503 3.92367L11.412 4.8093C11.413 4.81031 9.12789 6.28297 9.13602 6.24235Z"
                        fill="#FEC417"
                      />
                      <path
                        d="M12.1793 3.61187C12.1001 2.66531 11.1637 2.43883 10.7788 2.57594C10.3939 2.71304 10.144 2.97 10.0587 3.33562C9.98965 3.63117 9.92059 3.8282 9.84137 3.85867C9.75403 3.89117 9.67379 3.87797 9.67379 3.87797C9.67379 3.87797 9.65957 3.23812 9.66363 2.98015C9.67379 2.44797 9.83629 2.31187 9.83629 2.31187C9.83629 2.31187 9.80176 2.13211 9.7327 2.03258C9.66363 1.93406 9.53567 1.80609 9.53567 1.80609C9.53567 1.80609 9.56512 2.06203 9.43715 2.12195C9.30918 2.18187 9.17106 2.0925 9.17106 2.0925L9.29902 2.62469C9.29902 2.62469 9.09184 5.2775 9.07254 5.3364C9.05324 5.39531 8.27426 6.74609 8.27426 6.74609C8.27426 6.74609 7.82028 7.17062 7.60395 7.26914C7.3866 7.36765 7.19973 7.62461 6.36184 7.63375C5.52395 7.6439 4.80387 6.98273 4.80387 6.98273L4.08379 6.29211L3.5516 4.72398L3.47238 3.1264L3.5059 2.54547L3.52926 2.30273L3.49168 2.17984C3.49168 2.17984 3.42262 2.2489 3.29465 2.21945C3.16668 2.19 3.11692 2.02242 3.11692 2.02242C3.11692 2.02242 3.06715 2.10164 3.05801 2.14125C3.04785 2.18086 3.0377 2.27226 3.0377 2.27226C3.0377 2.27226 3.17582 2.4175 3.20527 2.62469C3.23473 2.83187 3.19512 3.69008 3.04785 3.66976C2.89957 3.65047 2.94832 2.93039 2.38668 2.65414C1.9002 2.41445 1.17402 2.48656 0.877462 3.08781C0.581915 3.68906 0.798244 4.39898 1.72551 5.06015C2.65277 5.72133 3.63996 6.27687 3.79637 6.80703C3.98324 7.43773 3.55973 7.8125 3.55973 7.8125C3.55973 7.8125 3.86746 7.76984 4.01879 7.43976C4.06754 7.33312 4.08582 7.17773 4.09293 7.08531C4.44332 7.54234 4.90949 7.92929 5.52699 8.11617C5.76059 8.1964 6.02363 8.23703 6.38926 8.23703C6.44207 8.23703 6.49387 8.235 6.54567 8.23297C6.97324 8.21773 7.33887 8.1375 7.69332 7.96179C8.17168 7.74039 8.54238 7.40219 8.82879 7.01828C8.82067 7.10969 8.87652 7.33718 8.98317 7.51695C9.17004 7.83281 9.4859 7.85211 9.4859 7.85211C9.4859 7.85211 9.05223 7.59617 9.14059 6.98476C9.22895 6.37336 9.63317 6.15601 10.2446 5.76195C10.858 5.36687 12.2575 4.55844 12.1793 3.61187ZM2.1602 4.95351C1.88496 4.75953 1.40254 4.50054 1.20348 4.10547C0.9384 3.57836 1.15371 2.94156 1.65746 2.86336C2.70356 2.69883 2.72285 3.99781 2.79192 4.15523C2.86098 4.31265 3.05801 4.32281 3.05801 4.32281C3.05801 4.32281 3.06512 4.41015 3.09356 4.57875C3.09457 4.58383 3.09559 4.58789 3.09559 4.59297L3.09863 4.6082C3.11793 4.72297 3.14535 4.86617 3.18395 5.02969L3.18699 5.04187C3.20832 5.13429 3.23067 5.22164 3.25402 5.30187C3.30074 5.47047 3.35762 5.65226 3.4277 5.83914C3.32613 5.77008 2.74418 5.36687 2.1602 4.95351ZM11.637 4.22328C11.4186 4.57672 10.9768 4.83976 10.6508 5.06117C10.2304 5.34656 9.60473 5.77515 9.42801 5.895C9.46863 5.78734 9.50418 5.6807 9.53668 5.57609C9.58949 5.43797 9.64535 5.26937 9.68395 5.08758C9.78551 4.61023 9.80277 4.19281 9.80277 4.19281C9.80277 4.19281 10.01 4.25172 10.1379 4.11359C10.2659 3.97547 10.3136 3.54687 10.4335 3.34476C10.6204 3.0289 10.9951 2.7039 11.5578 3.09797C11.8828 3.32648 11.895 3.80484 11.637 4.22328Z"
                        fill="#FFA828"
                      />
                      <path
                        d="M6.1462 8.55492L6.72003 8.54781C6.72003 8.54781 6.73527 9.17445 6.82566 9.64164C6.91605 10.1098 7.03691 10.6298 7.03691 10.6298C7.03691 10.6298 5.86792 11.0219 5.87503 10.5994C5.88214 10.1769 6.05581 9.35422 6.05581 9.35422C6.05581 9.35422 6.16144 8.37414 6.1462 8.55492Z"
                        fill="#FFA828"
                      />
                      <path
                        d="M5.41699 10.5557C5.41699 10.5557 5.80395 9.92602 5.8852 9.44867C5.96645 8.97133 6.01113 8.54883 6.01113 8.54883L6.25082 8.55898C6.25082 8.55898 6.22746 9.25062 6.20004 9.71883C6.17262 10.187 6.09238 10.6461 6.09238 10.6461L5.41699 10.5557Z"
                        fill="#FFEFAB"
                      />
                      <path
                        d="M5.71488 8.15883C5.71488 8.15883 5.89465 7.98312 6.38926 7.98312C6.88387 7.98312 7.09613 8.17305 7.09613 8.17305L7.10934 8.78344C7.10934 8.78344 6.78027 8.68086 6.38012 8.67578C6.04699 8.67172 5.68848 8.79562 5.68848 8.79562L5.71488 8.15883Z"
                        fill="#D1701C"
                      />
                      <path
                        d="M3.55428 2.09656C3.63756 2.01937 4.43585 1.42015 6.32592 1.4039C8.35921 1.38562 9.12194 1.97469 9.16967 2.00719C9.2235 2.04273 9.28647 2.20523 9.26006 2.27734C9.23264 2.34945 9.17881 2.37586 9.02647 2.31289C8.87311 2.24992 8.11749 1.69844 6.29952 1.75531C4.55366 1.80914 3.81327 2.34031 3.73506 2.385C3.6721 2.42055 3.5553 2.42969 3.50147 2.35758C3.44663 2.28648 3.50046 2.14734 3.55428 2.09656Z"
                        fill="#D1701C"
                      />
                      <path
                        d="M8.81305 11.9471L8.81203 10.4958H4.15336C4.16758 10.4958 4.15641 11.6759 4.15438 11.9522H3.49219V13.0034H9.4082V11.9522L8.81305 11.9471Z"
                        fill="#865C50"
                      />
                      <path
                        d="M5.64562 11.2585C5.53086 11.2534 5.39883 11.2768 5.39375 11.419C5.38867 11.5612 5.38867 11.9725 5.38867 12.0507C5.38867 12.1289 5.45266 12.197 5.61312 12.202C5.77359 12.2071 7.27977 12.202 7.38539 12.202C7.49102 12.202 7.54586 12.1106 7.54992 12.0192C7.555 11.9278 7.54484 11.5429 7.54484 11.4383C7.54484 11.2646 7.38945 11.2646 7.28383 11.2646C7.17008 11.2626 5.64562 11.2585 5.64562 11.2585Z"
                        fill="#FCC219"
                      />
                    </g>
                    <defs>
                      <clipPath id="clip0_3319_1051">
                        <rect
                          width="13"
                          height="13"
                          fill="white"
                          transform="translate(0 0.5)"
                        />
                      </clipPath>
                    </defs>
                  </svg>
                </div>
                <p className="text-[11px] text-[#C1FF70]">10 EUT</p>
              </div>
            </div>
            <div>
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="48"
                height="50"
                viewBox="0 0 48 78"
                fill="none"
              >
                <path
                  d="M29.2683 52.4701H17.0288C17.0288 49.6319 17.6674 46.9712 18.9446 44.4878C20.2217 41.9335 21.7827 39.7694 23.6275 37.9956C25.4723 36.1508 27.3171 34.4124 29.1619 32.7805C31.0066 31.0776 32.5676 29.2328 33.8448 27.2461C35.1219 25.2594 35.7605 23.2373 35.7605 21.1796C35.7605 18.2705 34.7317 16 32.6741 14.3681C30.6164 12.7361 27.8492 11.9202 24.3725 11.9202C21.0377 11.9202 18.1641 12.7716 15.7517 14.4745C13.3392 16.1774 11.6009 18.5898 10.5366 21.7118L0 15.7517C1.91574 10.7849 5.07317 6.91796 9.47228 4.15078C13.9423 1.38359 19.0155 0 24.6918 0C31.0776 0 36.541 1.80931 41.082 5.42794C45.694 9.04657 48 14.0488 48 20.4346C48 23.3437 47.3614 26.1109 46.0843 28.7361C44.8071 31.3614 43.2461 33.5965 41.4013 35.4412C39.5565 37.286 37.7118 39.0953 35.867 40.8692C34.0222 42.5721 32.4612 44.4169 31.184 46.4035C29.9069 48.3902 29.2683 50.4124 29.2683 52.4701ZM23.2018 61.1973C25.4013 61.1973 27.2816 61.9778 28.8426 63.5388C30.4035 65.0998 31.184 66.98 31.184 69.1796C31.184 71.3792 30.4035 73.2594 28.8426 74.8204C27.2816 76.3814 25.4013 77.1619 23.2018 77.1619C21.0022 77.1619 19.122 76.3814 17.561 74.8204C16 73.2594 15.2195 71.3792 15.2195 69.1796C15.2195 66.98 15.9645 65.0998 17.4545 63.5388C19.0155 61.9778 20.9313 61.1973 23.2018 61.1973Z"
                  fill="#C1FF70"
                />
              </svg>
            </div>
            </div>
            </div>
          </SwiperSlide>
        ))}
        
      </Swiper>
      
    
      
    </div>
  );
};

export default MysteryCardSlider;
